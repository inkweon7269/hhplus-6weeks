# Redis 캐싱 성능 개선 보고서

## 📊 개요

본 보고서는 NestJS 이커머스 서비스에 Redis 캐싱을 적용한 후의 성능 개선 효과를 측정하고 분석한 결과입니다.

### 테스트 환경

- **프레임워크**: NestJS
- **데이터베이스**: PostgreSQL
- **캐시 저장소**: Redis (DB 1번 사용)
- **테스트 방법**: 각 API 엔드포인트 10회 반복 호출
- **측정 시점**: 2025년 8월 15일

## 🚀 성능 측정 결과

### 1. API별 응답 시간 비교

| API 엔드포인트                      | 캐시 미스 (DB 조회) | 캐시 히트 (Redis 조회) | 성능 개선율 | 응답 시간 단축 |
| ----------------------------------- | ------------------- | ---------------------- | ----------- | -------------- |
| **상품 상세 조회** `/products/:id`  | 20ms                | 12ms                   | **40%**     | 8ms            |
| **잔액 조회** `/balances`           | 40ms                | 12ms                   | **70%**     | 28ms           |
| **쿠폰 목록** `/coupons`            | 14ms                | 10ms                   | **28%**     | 4ms            |
| **사용자 쿠폰** `/coupons/users/me` | 18ms                | 8ms                    | **55%**     | 10ms           |

### 2. 전체 성능 개선 요약

```
📈 핵심 지표
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
• 평균 캐시 미스 응답 시간: 23ms
• 평균 캐시 히트 응답 시간: 10ms
• 전체 평균 성능 개선율: 56.5%
• 평균 응답 시간 단축: 13ms
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 📈 성능 개선 분석

### 가장 큰 개선을 보인 API

1. **잔액 조회 (70% 개선)**

   - 원인: 사용자별 잔액 정보는 단순한 구조이지만 높은 빈도로 조회됨
   - 효과: 40ms → 12ms로 대폭 감소

2. **사용자 쿠폰 조회 (55% 개선)**
   - 원인: Join 연산이 포함된 복잡한 쿼리를 캐싱
   - 효과: 18ms → 8ms로 절반 이상 감소

### 상대적으로 적은 개선을 보인 API

1. **쿠폰 목록 조회 (28% 개선)**
   - 원인: 원래 쿼리가 이미 최적화되어 있어 기본 성능이 좋음
   - 효과: 14ms → 10ms로 소폭 감소

## 🔧 캐싱 구현 상세

### 캐시 키 전략

| API         | 캐시 키 패턴                                                | TTL          |
| ----------- | ----------------------------------------------------------- | ------------ |
| 상품 상세   | `product:detail:${id}`                                      | 600초 (10분) |
| 잔액 조회   | `user:${userId}:balance`                                    | 300초 (5분)  |
| 쿠폰 목록   | `coupons:list:page:${page}:limit:${limit}:status:${status}` | 300초 (5분)  |
| 사용자 쿠폰 | `user:${userId}:coupons:page:${page}:limit:${limit}`        | 180초 (3분)  |

### 캐시 무효화 전략

```typescript
// 각 도메인 서비스에서 직접 캐시 무효화 처리
- 잔액 변경 시: 해당 사용자 잔액 캐시 무효화
- 쿠폰 발급 시: 사용자 쿠폰 목록 + 전체 쿠폰 목록 캐시 무효화
- 쿠폰 사용 시: 사용자 쿠폰 목록 캐시 무효화
- 상품 정보 변경 시: 해당 상품 캐시 무효화
```
